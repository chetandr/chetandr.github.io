<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="height=width=device-height, width=device-width, initial-scale=1.0" />
		<style>
			#container {
				position: relative;
			}

			/* video {
				width: 300px;
				display: none;
			} */

			#changeVideo {
				position: absolute;
				top: 10px;
				left: 10px;
				width: 25px;
				height: 25px;
				opacity: 0;
				transition: opacity 0.3s ease;
				cursor: pointer;

				/* Additional styles just to increase visual appeal */
				border-radius: 50%;
				background: #ffffffdd;
				color: red;
				font-weight: bold;
				line-height: 25px;
				text-align: center;
				/* End */
			}

			/* On hovering the video, show the button */
			video:hover ~ #changeVideo {
				opacity: 1;
			}

			#changeVideo:hover {
				opacity: 1;
			}
		</style>
	</head>
	<body>
		<div id="debug"></div>
		<div class="container">
			<div>
				<video id="video" width="640px" height="480px" autoplay></video>
			</div>
			<div id="changeVideo">
				<button
					id="snap"
					style="
						margin-top: 50px;
						top: 0px;
						right: 0px;
						padding: 20px;
						background-color: #3f4756;
						color: #ffffff;
					"
				>
					Capture Image
				</button>
			</div>
		</div>
		<div>
			<canvas id="canvas"> </canvas>
		</div>
		<a id="downloadAnchor" href="">image</a>
		<img id="photo" />
		<script>
			const img = document.getElementById('photo');
			const video = document.getElementById('video');
			const a = document.getElementById('downloadAnchor');
			// a.style = 'display: none';
			let imageCapture;
			let div;
			const getCamera = async () => {
				const devices = await navigator.mediaDevices.enumerateDevices();

				devices.map(function (device) {
					div = document.createElement('div');
					div.innerText = JSON.stringify(device);
					div.style.border = 'solid 1px #000';
					debug.append(div);
				});

				const backDevice = devices.filter(
					(device) => device.kind === 'videoinput' && device.label.indexOf('back') >= 0,
				);
				div = document.createElement('div');
				div.innerText = JSON.stringify(backDevice.length);
				div.style.border = 'solid 1px #000';
				div.style.color = '#f00';
				debug.append(div);
				if (backDevice.length) {
					let constraint = {
						video: {
							width: {
								min: 1280,
								ideal: 1920,
								max: 2560,
							},
							height: {
								min: 720,
								ideal: 1080,
								max: 1440,
							},
							deviceId: backDevice[0].deviceId,
						},
					};

					const mediaStream = await navigator.mediaDevices.getUserMedia(constraint);
					document.querySelector('video').srcObject = mediaStream;
					tracks = await mediaStream.getVideoTracks();
					// imageCapture = new ImageCapture(tracks[0]);
					// const imageHandle = await imageCapture.getPhotoCapabilities();
					div = document.createElement('div');
					div.innerText = 'No Back Camera';
					div.style.border = 'solid 1px #000';
					div.style.color = '#fff';
					div.style.backgroundColor = '#f00';
					video.addEventListener('click', () => {
						const context = canvas.getContext('2d');
						canvas.width = 1280;
						canvas.height = 720;
						context.drawImage(video, 0, 0, 1280, 720);
						var url = canvas.toDataURL('image/png');
						img.setAttribute('src', url);
						canvas.style.display = 'none';
						img.style.display = 'none';
						a.href = url;
						a.download = 'MyPhoto.png';
						a.click();

						window.URL.revokeObjectURL(url);

					});
				} else {
					div = document.createElement('div');
					div.innerText = 'No Back Camera';
					div.style.border = 'solid 1px #000';
					div.style.color = '#fff';
					div.style.backgroundColor = '#f00';
					debug.append(div);
					let constraint = {
						video: {
							width: {
								min: 1280,
								ideal: 1920,
								max: 2560,
							},
							height: {
								min: 720,
								ideal: 1080,
								max: 1440,
							},
						},
					};
					const mediaStream = await navigator.mediaDevices.getUserMedia(constraint);
					document.querySelector('video').srcObject = mediaStream;
					tracks = await mediaStream.getVideoTracks();
					div = document.createElement('div');
					div.innerText = 'No Back Camera';
					div.style.border = 'solid 1px #000';
					div.style.color = '#fff';
					div.style.backgroundColor = '#f00';
					video.addEventListener('click', () => {
						const context = canvas.getContext('2d');
						canvas.width = 1280;
						canvas.height = 720;
						context.drawImage(video, 0, 0, 1280, 720);
						var url = canvas.toDataURL('image/png');
						img.setAttribute('src', url);
						canvas.style.display = 'none';
						img.style.display = 'none';
						a.href = url;
						a.download = 'MyPhoto.png';
						a.click();

						window.URL.revokeObjectURL(url);

					});
				}
			};

			getCamera();

			// ctx.beginPath();
			// ctx.lineWidth = 10;
			// ctx.strokeStyle = "#FFFFFF";

			// drawEllipse(ctx, 200, 75, 300, 400);
			// ctx.stroke();
		</script>
	</body>
</html>
